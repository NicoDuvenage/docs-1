<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2708px" preserveAspectRatio="none" style="width:1610px;height:2708px;" version="1.1" viewBox="0 0 1610 2708" width="1610.4px" zoomAndPan="magnify"><defs><filter height="300%" id="fvoctuhfws6d3" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.600000023841858"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="3.200000047683716" dy="3.200000047683716" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="11.2" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="225.6" x="693.2" y="18.8281">2.1.1. Fulfil Handler Consume (Success)</text><rect fill="#FFFFE0" height="2672.1235" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="1479.6" x="23.2" y="27.5906"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80.8" x="722.6" y="37.6453">Central Service</text><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="63.2" y="156.7266"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="2538.2938" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="308.8" y="101.0297"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="795.2" y="2458.4016"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1022" y="2537.2625"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="121.7391" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1128.4" y="544.4531"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="109.4906" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1128.4" y="754.9375"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="97.7938" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1128.4" y="1212.9016"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="97.2422" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1128.4" y="1376.7922"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="121.2422" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1128.4" y="1640.5735"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="110.0422" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1128.4" y="1828.4094"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="621.7266" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1128.4" y="2018.3969"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="74.5938" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1457.2" y="568.15"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="62.3453" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1457.2" y="778.6344"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1457.2" y="1236.5985"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="50.0969" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1457.2" y="1400.4891"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="23.4484" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1457.2" y="1664.2703"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1457.2" y="1852.1063"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1457.2" y="2042.0938"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="2527.0938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1591.2" x="10.4" y="106.6297"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="2502.0453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1575.2" x="18.4" y="126.0781"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="84.9938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="410.8" x="241.2" y="192.975"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="59.9453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="394.8" x="249.2" y="212.4234"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="73.7938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="718" x="249.2" y="289.1688"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="82.5938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="843.6" x="249.2" y="374.1625"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="854.9875" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1360.4" x="225.2" y="467.9563"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="605.0547" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1330" x="233.2" y="712.2891"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="289.8609" style="stroke: #000000; stroke-width: 1.600000023841858;" width="859.6" x="241.2" y="876.6766"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="47.6969" style="stroke: #000000; stroke-width: 1.600000023841858;" width="210.8" x="249.2" y="896.125"/><rect fill="#FFFFFF" height="85.7578" style="stroke: none; stroke-width: 0.800000011920929;" width="859.6" x="241.2" y="949.4219"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="62.5938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="843.6" x="249.2" y="966.986"/><rect fill="#FFFFFF" height="70.8609" style="stroke: none; stroke-width: 0.800000011920929;" width="859.6" x="241.2" y="1035.1797"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="47.6969" style="stroke: #000000; stroke-width: 1.600000023841858;" width="187.6" x="249.2" y="1052.7438"/><rect fill="#FFFFFF" height="60.4969" style="stroke: none; stroke-width: 0.800000011920929;" width="859.6" x="241.2" y="1106.0406"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="47.6969" style="stroke: #000000; stroke-width: 1.600000023841858;" width="278.8" x="249.2" y="1113.2406"/><rect fill="#FFFFFF" height="145.2063" style="stroke: none; stroke-width: 0.800000011920929;" width="1330" x="233.2" y="1172.1375"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="1244.9672" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1312.4" x="233.2" y="1334.1438"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="196.0844" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1291.6" x="241.2" y="1578.4766"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="171.0359" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1275.6" x="249.2" y="1597.925"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="159.3391" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1274.8" x="249.2" y="1785.761"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="617.2109" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1296.4" x="241.2" y="1956.3"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="147.0906" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1280.4" x="249.2" y="1975.7485"/><rect fill="#FFFFFF" height="84.4609" style="stroke: none; stroke-width: 0.800000011920929;" width="1296.4" x="241.2" y="2489.05"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="61.2969" style="stroke: #000000; stroke-width: 1.600000023841858;" width="843.6" x="249.2" y="2506.6141"/><rect fill="#FFFFFF" height="43.4125" style="stroke: none; stroke-width: 0.800000011920929;" width="1575.2" x="18.4" y="2584.711"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="67.2" x2="67.2" y1="93.0297" y2="2647.3235"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="312.4" x2="312.4" y1="93.0297" y2="2647.3235"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="799.2" x2="799.2" y1="93.0297" y2="2647.3235"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="916.8" x2="916.8" y1="93.0297" y2="2647.3235"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="1025.6" x2="1025.6" y1="93.0297" y2="2647.3235"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="1132" x2="1132" y1="93.0297" y2="2647.3235"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="1461.2" x2="1461.2" y1="93.0297" y2="2647.3235"/><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="75.2" x="29.6" y="61.4391"/><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="75.2" x="26.4" y="64.6391"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="64" x="32" y="81.0672">Fulfil-Topic</text><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="75.2" x="29.6" y="2646.5235"/><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="75.2" x="26.4" y="2649.7235"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="64" x="32" y="2666.1516">Fulfil-Topic</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="106.4" x="257.2" y="90.6672">Fulfil Event Handler</text><ellipse cx="312.8" cy="67.0391" fill="#FEFECE" filter="url(#fvoctuhfws6d3)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><polygon fill="#A80036" points="309.6,57.4391,314.4,53.4391,312.8,57.4391,314.4,61.4391,309.6,57.4391" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="106.4" x="257.2" y="2657.3516">Fulfil Event Handler</text><ellipse cx="312.8" cy="2672.5141" fill="#FEFECE" filter="url(#fvoctuhfws6d3)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><polygon fill="#A80036" points="309.6,2662.9141,314.4,2658.9141,312.8,2662.9141,314.4,2666.9141,309.6,2662.9141" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="129.6" x="734.4" y="61.4391"/><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="129.6" x="731.2" y="64.6391"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="118.4" x="736.8" y="81.0672">Position-Topic-dfsp2</text><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="129.6" x="734.4" y="2646.5235"/><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="129.6" x="731.2" y="2649.7235"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="118.4" x="736.8" y="2666.1516">Position-Topic-dfsp2</text><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="77.6" x="878.4" y="61.4391"/><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="77.6" x="875.2" y="64.6391"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="66.4" x="880.8" y="81.0672">Event-Topic</text><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="77.6" x="878.4" y="2646.5235"/><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="77.6" x="875.2" y="2649.7235"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="66.4" x="880.8" y="2666.1516">Event-Topic</text><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="970.4" y="61.4391"/><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="967.2" y="64.6391"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="972.8" y="81.0672">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="970.4" y="2646.5235"/><rect fill="#FEFECE" filter="url(#fvoctuhfws6d3)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="967.2" y="2649.7235"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="972.8" y="2666.1516">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="74.4" x="1092.8" y="90.6672">Transfer DAO</text><ellipse cx="1132.4" cy="67.0391" fill="#FEFECE" filter="url(#fvoctuhfws6d3)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><line style="stroke: #A80036; stroke-width: 1.600000023841858;" x1="1122.8" x2="1142" y1="78.2391" y2="78.2391"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="74.4" x="1092.8" y="2657.3516">Transfer DAO</text><ellipse cx="1132.4" cy="2672.5141" fill="#FEFECE" filter="url(#fvoctuhfws6d3)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><line style="stroke: #A80036; stroke-width: 1.600000023841858;" x1="1122.8" x2="1142" y1="2683.7141" y2="2683.7141"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="72" x="1422.8" y="90.6672">Central Store</text><path d="M1446.8,51.0391 C1446.8,43.0391 1461.2,43.0391 1461.2,43.0391 C1461.2,43.0391 1475.6,43.0391 1475.6,51.0391 L1475.6,71.8391 C1475.6,79.8391 1461.2,79.8391 1461.2,79.8391 C1461.2,79.8391 1446.8,79.8391 1446.8,71.8391 L1446.8,51.0391 " fill="#FEFECE" filter="url(#fvoctuhfws6d3)" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><path d="M1446.8,51.0391 C1446.8,59.0391 1461.2,59.0391 1461.2,59.0391 C1461.2,59.0391 1475.6,59.0391 1475.6,51.0391 " fill="none" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="72" x="1422.8" y="2657.3516">Central Store</text><path d="M1446.8,2667.7141 C1446.8,2659.7141 1461.2,2659.7141 1461.2,2659.7141 C1461.2,2659.7141 1475.6,2659.7141 1475.6,2667.7141 L1475.6,2688.5141 C1475.6,2696.5141 1461.2,2696.5141 1461.2,2696.5141 C1461.2,2696.5141 1446.8,2696.5141 1446.8,2688.5141 L1446.8,2667.7141 " fill="#FEFECE" filter="url(#fvoctuhfws6d3)" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><path d="M1446.8,2667.7141 C1446.8,2675.7141 1461.2,2675.7141 1461.2,2675.7141 C1461.2,2675.7141 1475.6,2675.7141 1475.6,2667.7141 " fill="none" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="63.2" y="156.7266"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="2538.2938" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="308.8" y="101.0297"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="795.2" y="2458.4016"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1022" y="2537.2625"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="121.7391" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1128.4" y="544.4531"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="109.4906" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1128.4" y="754.9375"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="97.7938" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1128.4" y="1212.9016"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="97.2422" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1128.4" y="1376.7922"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="121.2422" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1128.4" y="1640.5735"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="110.0422" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1128.4" y="1828.4094"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="621.7266" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1128.4" y="2018.3969"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="74.5938" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1457.2" y="568.15"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="62.3453" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1457.2" y="778.6344"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1457.2" y="1236.5985"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="50.0969" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1457.2" y="1400.4891"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="23.4484" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1457.2" y="1664.2703"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1457.2" y="1852.1063"/><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="1457.2" y="2042.0938"/><path d="M10.4,106.6297 L225.6,106.6297 L225.6,112.2297 L217.6,120.2297 L10.4,120.2297 L10.4,106.6297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="2527.0938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1591.2" x="10.4" y="106.6297"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="179.2" x="22.4" y="117.4844">Fulfil Handler Consume (Success)</text><path d="M18.4,126.0781 L68,126.0781 L68,131.6781 L60,139.6781 L18.4,139.6781 L18.4,126.0781 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="2502.0453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1575.2" x="18.4" y="126.0781"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="30.4" y="136.9328">alt</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="119.2" x="80" y="136.1859">[Consume Single Message]</text><polygon fill="#A80036" points="80,153.5266,72,156.7266,80,159.9266,76.8,156.7266" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="75.2" x2="308" y1="156.7266" y2="156.7266"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="84.8" y="153.1813">1</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="212" x="95.2" y="153.1813">Consume Prepare event message for Payer</text><path d="M241.2,192.975 L308.4,192.975 L308.4,198.575 L300.4,206.575 L241.2,206.575 L241.2,192.975 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="84.9938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="410.8" x="241.2" y="192.975"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="253.2" y="203.8297">break</text><path d="M249.2,212.4234 L362.8,212.4234 L362.8,218.0234 L354.8,226.0234 L249.2,226.0234 L249.2,212.4234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="59.9453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="394.8" x="249.2" y="212.4234"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77.6" x="261.2" y="223.2781">Validate Event</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="350.4" y1="255.5688" y2="255.5688"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="350.4" x2="350.4" y1="255.5688" y2="265.9688"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="317.6" x2="350.4" y1="265.9688" y2="265.9688"/><polygon fill="#A80036" points="325.6,262.7688,317.6,265.9688,325.6,269.1688,322.4,265.9688" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="322.4" y="245.6508">2</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="301.6" x="332.8" y="239.5266">Validate event - Rule: type == 'fulfil' &amp;&amp; action == 'commit'</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="332.8" y="251.775">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="400" y="251.775">2001</text><path d="M249.2,289.1688 L421.2,289.1688 L421.2,294.7688 L413.2,302.7688 L249.2,302.7688 L249.2,289.1688 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="73.7938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="718" x="249.2" y="289.1688"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="261.2" y="300.0234">Persist Event Information</text><polygon fill="#A80036" points="907.6,316.6172,915.6,319.8172,907.6,323.0172,910.8,319.8172" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="912.4" y1="319.8172" y2="319.8172"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="322.4" y="316.2719">3</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="129.6" x="332.8" y="316.2719">Publish event information</text><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="32.4969" style="stroke: #000000; stroke-width: 1.600000023841858;" width="703.6" x="254.8" y="326.4656"/><polygon fill="#EEEEEE" points="254.8,326.4656,306,326.4656,306,332.0656,298,340.0656,254.8,340.0656,254.8,326.4656" style="stroke: #000000; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15.2" x="265.2" y="338.1203">ref</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="158.4" x="529" y="353.3203">Event Handler Consume {9.1.0.}</text><path d="M249.2,374.1625 L426.8,374.1625 L426.8,379.7625 L418.8,387.7625 L249.2,387.7625 L249.2,374.1625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="82.5938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="843.6" x="249.2" y="374.1625"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="141.6" x="261.2" y="385.0172">Validate FSPIOP-Signature</text><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="44.7453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="829.2" x="254.8" y="408.0109"/><polygon fill="#EEEEEE" points="254.8,408.0109,306,408.0109,306,413.6109,298,421.6109,254.8,421.6109,254.8,408.0109" style="stroke: #000000; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15.2" x="265.2" y="419.6656">ref</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="174.4" x="466.6" y="434.8656">Validate message.content.headers.</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="94.4" x="641" y="434.8656">FSPIOP-Signature</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="133.6" x="738.6" y="434.8656">{seq-signature-validation}</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="466.6" y="447.1141">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="533.8" y="447.1141">2001</text><path d="M225.2,467.9563 L502.8,467.9563 L502.8,473.5563 L494.8,481.5563 L225.2,481.5563 L225.2,467.9563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="854.9875" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1360.4" x="225.2" y="467.9563"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="241.6" x="237.2" y="478.8109">Validate Transfer Fulfilment Duplicate Check</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="350.4" y1="498.8531" y2="498.8531"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="350.4" x2="350.4" y1="498.8531" y2="509.2531"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="317.6" x2="350.4" y1="509.2531" y2="509.2531"/><polygon fill="#A80036" points="325.6,506.0531,317.6,509.2531,325.6,512.4531,322.4,509.2531" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="322.4" y="495.0594">4</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="172.8" x="332.8" y="495.0594">Generate transferFulfilmentId uuid</text><polygon fill="#A80036" points="1118.8,541.2531,1126.8,544.4531,1118.8,547.6531,1122,544.4531" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="1123.6" y1="544.4531" y2="544.4531"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="322.4" y="535.032">5</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="295.2" x="332.8" y="528.9078">Request to retrieve transfer fulfilment hashes by transferId</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="332.8" y="541.1563">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="394.4" y="541.1563">2003</text><polygon fill="#A80036" points="1447.6,564.95,1455.6,568.15,1447.6,571.35,1450.8,568.15" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="1136.4" x2="1452.4" y1="568.15" y2="568.15"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="1142" y="564.6047">6</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="272.8" x="1152.4" y="564.6047">Request Transfer fulfilment duplicate message hashes</text><polygon fill="#FFFFE0" filter="url(#fvoctuhfws6d3)" points="1352.8,578.7984,1569.6,578.7984,1577.6,599.5984,1569.6,621.1984,1352.8,621.1984,1344.8,599.5984,1352.8,578.7984" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="111.2" x="1354.4" y="592.0531">SELET transferId, hash</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="28.8" x="1354.4" y="604.3016">FROM</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="181.6" x="1386.4" y="604.3016">transferFulfilmentDuplicateCheck</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="191.2" x="1354.4" y="616.55">WHERE transferId = request.params.id</text><polygon fill="#A80036" points="1145.2,639.5438,1137.2,642.7438,1145.2,645.9438,1142,642.7438" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="1140.4" x2="1460.4" y1="642.7438" y2="642.7438"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="1150" y="639.1984">7</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="115.2" x="1160.4" y="639.1984">Return existing hashes</text><polygon fill="#A80036" points="325.6,662.9922,317.6,666.1922,325.6,669.3922,322.4,666.1922" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="320.8" x2="1131.6" y1="666.1922" y2="666.1922"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="330.4" y="662.6469">8</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="239.2" x="340.8" y="662.6469">Return (list of) transfer fulfil messages hash(es)</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="350.4" y1="689.8891" y2="689.8891"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="350.4" x2="350.4" y1="689.8891" y2="700.2891"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="317.6" x2="350.4" y1="700.2891" y2="700.2891"/><polygon fill="#A80036" points="325.6,697.0891,317.6,700.2891,325.6,703.4891,322.4,700.2891" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="322.4" y="686.0953">9</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="456.8" x="332.8" y="686.0953">Loop the list of returned hashes and compare each entry with the calculated message hash</text><path d="M233.2,712.2891 L282.8,712.2891 L282.8,717.8891 L274.8,725.8891 L233.2,725.8891 L233.2,712.2891 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="605.0547" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1330" x="233.2" y="712.2891"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="245.2" y="723.1438">alt</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="69.6" x="294.8" y="722.3969">[Hash matched]</text><polygon fill="#A80036" points="1118.8,751.7375,1126.8,754.9375,1118.8,758.1375,1122,754.9375" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="1123.6" y1="754.9375" y2="754.9375"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="322.4" y="745.5164">10</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="288" x="340" y="739.3922">Request to retrieve Transfer Fulfilment and Transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="340" y="751.6406">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="401.6" y="751.6406">2003</text><polygon fill="#A80036" points="1447.6,775.4344,1455.6,778.6344,1447.6,781.8344,1450.8,778.6344" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="1136.4" x2="1452.4" y1="778.6344" y2="778.6344"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="1142" y="775.0891">11</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="288" x="1159.6" y="775.0891">Request to retrieve Transfer Fulfilment and Transfer state</text><polygon fill="#FFFFE0" filter="url(#fvoctuhfws6d3)" points="1408.8,789.2828,1513.6,789.2828,1521.6,804.4828,1513.6,819.6828,1408.8,819.6828,1400.8,804.4828,1408.8,789.2828" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="90.4" x="1410.4" y="802.5375">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="101.6" x="1410.4" y="814.7859">transferStateChange</text><polygon fill="#A80036" points="1145.2,837.7797,1137.2,840.9797,1145.2,844.1797,1142,840.9797" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="1140.4" x2="1460.4" y1="840.9797" y2="840.9797"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="1150" y="837.4344">12</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="226.4" x="1167.6" y="837.4344">Return Transfer Fulfilment and Transfer state</text><polygon fill="#A80036" points="325.6,861.2281,317.6,864.4281,325.6,867.6281,322.4,864.4281" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="320.8" x2="1131.6" y1="864.4281" y2="864.4281"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="330.4" y="860.8828">13</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="226.4" x="348" y="860.8828">Return Transfer Fulfilment and Transfer state</text><path d="M241.2,876.6766 L290.8,876.6766 L290.8,882.2766 L282.8,890.2766 L241.2,890.2766 L241.2,876.6766 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="289.8609" style="stroke: #000000; stroke-width: 1.600000023841858;" width="859.6" x="241.2" y="876.6766"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="253.2" y="887.5313">alt</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="148" x="302.8" y="886.7844">[transferFulfilment.isValid == 0]</text><path d="M249.2,896.125 L316.4,896.125 L316.4,901.725 L308.4,909.725 L249.2,909.725 L249.2,896.125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="47.6969" style="stroke: #000000; stroke-width: 1.600000023841858;" width="210.8" x="249.2" y="896.125"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="261.2" y="906.9797">break</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="350.4" y1="927.0219" y2="927.0219"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="350.4" x2="350.4" y1="927.0219" y2="937.4219"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="317.6" x2="350.4" y1="937.4219" y2="937.4219"/><polygon fill="#A80036" points="325.6,934.2219,317.6,937.4219,325.6,940.6219,322.4,937.4219" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="322.4" y="923.2281">14</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81.6" x="340" y="923.2281">Error handling:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="424.8" y="923.2281">3105</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="241.2" x2="1100.8" y1="950.2219" y2="950.2219"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203.2" x="245.2" y="958.7297">[transferState IN ['COMMITTED', 'ABORTED']]</text><path d="M249.2,966.986 L316.4,966.986 L316.4,972.586 L308.4,980.586 L249.2,980.586 L249.2,966.986 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="62.5938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="843.6" x="249.2" y="966.986"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="261.2" y="977.8406">break</text><rect fill="#FFFFFF" filter="url(#fvoctuhfws6d3)" height="44.7453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="829.2" x="254.8" y="980.8344"/><polygon fill="#EEEEEE" points="254.8,980.8344,306,980.8344,306,986.4344,298,994.4344,254.8,994.4344,254.8,980.8344" style="stroke: #000000; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15.2" x="265.2" y="992.4891">ref</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="232" x="553.4" y="1007.6891">Send notification to Participant (Payee) {1.1.4.}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="556.6" y="1019.9375"/><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="241.2" x2="1100.8" y1="1035.9797" y2="1035.9797"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="141.6" x="245.2" y="1044.4875">[transferState NOT 'RESERVED']</text><path d="M249.2,1052.7438 L316.4,1052.7438 L316.4,1058.3438 L308.4,1066.3438 L249.2,1066.3438 L249.2,1052.7438 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="47.6969" style="stroke: #000000; stroke-width: 1.600000023841858;" width="187.6" x="249.2" y="1052.7438"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="261.2" y="1063.5985">break</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="350.4" y1="1083.6406" y2="1083.6406"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="350.4" x2="350.4" y1="1083.6406" y2="1094.0406"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="317.6" x2="350.4" y1="1094.0406" y2="1094.0406"/><polygon fill="#A80036" points="325.6,1090.8406,317.6,1094.0406,325.6,1097.2406,322.4,1094.0406" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="322.4" y="1079.8469">15</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="340" y="1079.8469">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="401.6" y="1079.8469">2001</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="241.2" x2="1100.8" y1="1106.8406" y2="1106.8406"/><path d="M249.2,1113.2406 L316.4,1113.2406 L316.4,1118.8406 L308.4,1126.8406 L249.2,1126.8406 L249.2,1113.2406 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="47.6969" style="stroke: #000000; stroke-width: 1.600000023841858;" width="278.8" x="249.2" y="1113.2406"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="261.2" y="1124.0953">break</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="350.4" y1="1144.1375" y2="1144.1375"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="350.4" x2="350.4" y1="1144.1375" y2="1154.5375"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="317.6" x2="350.4" y1="1154.5375" y2="1154.5375"/><polygon fill="#A80036" points="325.6,1151.3375,317.6,1154.5375,325.6,1157.7375,322.4,1154.5375" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="322.4" y="1140.3438">16</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="178.4" x="340" y="1140.3438">Allow previous request to complete</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="233.2" x2="1563.2" y1="1172.9375" y2="1172.9375"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87.2" x="237.2" y="1181.4453">[Hash not matched]</text><polygon fill="#A80036" points="1118.8,1209.7016,1126.8,1212.9016,1118.8,1216.1016,1122,1212.9016" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="1123.6" y1="1212.9016" y2="1212.9016"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="322.4" y="1203.4805">17</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="160.8" x="340" y="1197.3563">Request to persist transfer hash</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="340" y="1209.6047">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="407.2" y="1209.6047">2003</text><polygon fill="#A80036" points="1447.6,1233.3985,1455.6,1236.5985,1447.6,1239.7985,1450.8,1236.5985" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="1136.4" x2="1452.4" y1="1236.5985" y2="1236.5985"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="1142" y="1233.0531">18</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="60.8" x="1159.6" y="1233.0531">Persist hash</text><polygon fill="#FFFFE0" filter="url(#fvoctuhfws6d3)" points="1374.4,1271.2469,1547.2,1271.2469,1555.2,1280.0469,1547.2,1289.6469,1374.4,1289.6469,1366.4,1280.0469,1374.4,1271.2469" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="169.6" x="1376" y="1284.5016">transferFulfilmentDuplicateCheck</text><polygon fill="#A80036" points="325.6,1307.4953,317.6,1310.6953,325.6,1313.8953,322.4,1310.6953" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="320.8" x2="1131.6" y1="1310.6953" y2="1310.6953"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="330.4" y="1307.15">19</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="76" x="348" y="1307.15">Return success</text><path d="M233.2,1334.1438 L484.4,1334.1438 L484.4,1339.7438 L476.4,1347.7438 L233.2,1347.7438 L233.2,1334.1438 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="1244.9672" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1312.4" x="233.2" y="1334.1438"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="215.2" x="245.2" y="1344.9985">Validate and persist Transfer Fulfilment</text><polygon fill="#A80036" points="1118.8,1373.5922,1126.8,1376.7922,1118.8,1379.9922,1122,1376.7922" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="1123.6" y1="1376.7922" y2="1376.7922"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="322.4" y="1367.3711">20</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="220" x="340" y="1361.2469">Request information for the validate checks</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="340" y="1373.4953">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="401.6" y="1373.4953">2003</text><polygon fill="#A80036" points="1447.6,1397.2891,1455.6,1400.4891,1447.6,1403.6891,1450.8,1400.4891" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="1136.4" x2="1452.4" y1="1400.4891" y2="1400.4891"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="1142" y="1396.9438">21</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="102.4" x="1159.6" y="1396.9438">Fetch from database</text><polygon fill="#FFFFE0" filter="url(#fvoctuhfws6d3)" points="1440,1411.1375,1482.4,1411.1375,1490.4,1419.9375,1482.4,1429.5375,1440,1429.5375,1432,1419.9375,1440,1411.1375" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="39.2" x="1441.6" y="1424.3922">transfer</text><polygon fill="#A80036" points="1145.2,1447.386,1137.2,1450.586,1145.2,1453.786,1142,1450.586" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="1140.4" x2="1460.4" y1="1450.586" y2="1450.586"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="1150" y="1447.0406">22</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="1170.8" y="1447.0406"/><polygon fill="#A80036" points="325.6,1470.8344,317.6,1474.0344,325.6,1477.2344,322.4,1474.0344" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="320.8" x2="1131.6" y1="1474.0344" y2="1474.0344"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="330.4" y="1470.4891">23</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="75.2" x="348" y="1470.4891">Return transfer</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="350.4" y1="1509.9797" y2="1509.9797"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="350.4" x2="350.4" y1="1509.9797" y2="1520.3797"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="317.6" x2="350.4" y1="1520.3797" y2="1520.3797"/><polygon fill="#A80036" points="325.6,1517.1797,317.6,1520.3797,325.6,1523.5797,322.4,1520.3797" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="322.4" y="1500.0617">24</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="377.6" x="340" y="1493.9375">Validate that Transfer.ilpCondition = SHA-256 (content.payload.fulfilment)</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="340" y="1506.186">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="401.6" y="1506.186">2001</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="350.4" y1="1556.0766" y2="1556.0766"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="350.4" x2="350.4" y1="1556.0766" y2="1566.4766"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="317.6" x2="350.4" y1="1566.4766" y2="1566.4766"/><polygon fill="#A80036" points="325.6,1563.2766,317.6,1566.4766,325.6,1569.6766,322.4,1566.4766" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="322.4" y="1546.1586">25</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="117.6" x="340" y="1540.0344">Validate expirationDate</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="340" y="1552.2828">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="401.6" y="1552.2828">3303</text><path d="M241.2,1578.4766 L294.8,1578.4766 L294.8,1584.0766 L286.8,1592.0766 L241.2,1592.0766 L241.2,1578.4766 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="196.0844" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1291.6" x="241.2" y="1578.4766"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17.6" x="253.2" y="1589.3313">opt</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="192" x="306.8" y="1588.5844">[Transfer.ilpCondition validate successful]</text><path d="M249.2,1597.925 L478.8,1597.925 L478.8,1603.525 L470.8,1611.525 L249.2,1611.525 L249.2,1597.925 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="171.0359" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1275.6" x="249.2" y="1597.925"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="193.6" x="261.2" y="1608.7797">Request current Settlement Window</text><polygon fill="#A80036" points="1118.8,1637.3735,1126.8,1640.5735,1118.8,1643.7735,1122,1640.5735" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="1123.6" y1="1640.5735" y2="1640.5735"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="322.4" y="1631.1524">26</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="308" x="340" y="1625.0281">Request to retrieve current/latest transfer settlement window</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="340" y="1637.2766">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="401.6" y="1637.2766">2003</text><polygon fill="#A80036" points="1447.6,1661.0703,1455.6,1664.2703,1447.6,1667.4703,1450.8,1664.2703" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="1136.4" x2="1452.4" y1="1664.2703" y2="1664.2703"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="1142" y="1660.725">27</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="132.8" x="1159.6" y="1660.725">Fetch settlementWindowId</text><polygon fill="#A80036" points="1145.2,1684.5188,1137.2,1687.7188,1145.2,1690.9188,1142,1687.7188" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="1140.4" x2="1460.4" y1="1687.7188" y2="1687.7188"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="1150" y="1684.1735">28</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="1170.8" y="1684.1735"/><polygon fill="#FFFFE0" filter="url(#fvoctuhfws6d3)" points="1412.8,1698.3672,1508.8,1698.3672,1516.8,1707.1672,1508.8,1716.7672,1412.8,1716.7672,1404.8,1707.1672,1412.8,1698.3672" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="92.8" x="1414.4" y="1711.6219">settlementWindow</text><polygon fill="#A80036" points="325.6,1758.6157,317.6,1761.8157,325.6,1765.0157,322.4,1761.8157" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="320.8" x2="1131.6" y1="1761.8157" y2="1761.8157"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="330.4" y="1746.5188">29</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="380.8" x="348" y="1734.2703">Return settlementWindowId to be appended during transferFulfilment insert</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32.8" x="348" y="1746.5188">TODO</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="345.6" x="380.8" y="1746.5188">: During settlement design make sure transfers in 'RECEIVED-FULFIL'</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="244" x="348" y="1758.7672">state are updated to the next settlement window</text><path d="M249.2,1785.761 L377.2,1785.761 L377.2,1791.361 L369.2,1799.361 L249.2,1799.361 L249.2,1785.761 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="159.3391" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1274.8" x="249.2" y="1785.761"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="92" x="261.2" y="1796.6157">Persist fulfilment</text><polygon fill="#A80036" points="1118.8,1825.2094,1126.8,1828.4094,1118.8,1831.6094,1122,1828.4094" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="1123.6" y1="1828.4094" y2="1828.4094"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="322.4" y="1818.9883">30</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="397.6" x="340" y="1812.8641">Persist fulfilment with the result of the above check (transferFulfilment.isValid)</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="340" y="1825.1125">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="401.6" y="1825.1125">2003</text><polygon fill="#A80036" points="1447.6,1848.9063,1455.6,1852.1063,1447.6,1855.3063,1450.8,1852.1063" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="1136.4" x2="1452.4" y1="1852.1063" y2="1852.1063"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="1142" y="1848.561">31</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="95.2" x="1159.6" y="1848.561">Persist to database</text><polygon fill="#FFFFE0" filter="url(#fvoctuhfws6d3)" points="1414.4,1886.7547,1508,1886.7547,1516,1901.9547,1508,1917.1547,1414.4,1917.1547,1406.4,1901.9547,1414.4,1886.7547" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="90.4" x="1416" y="1900.0094">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="88.8" x="1416" y="1912.2578">transferExtension</text><polygon fill="#A80036" points="325.6,1935.2516,317.6,1938.4516,325.6,1941.6516,322.4,1938.4516" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="320.8" x2="1131.6" y1="1938.4516" y2="1938.4516"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="330.4" y="1934.9063">32</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="76" x="348" y="1934.9063">Return success</text><path d="M241.2,1956.3 L290.8,1956.3 L290.8,1961.9 L282.8,1969.9 L241.2,1969.9 L241.2,1956.3 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="617.2109" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1296.4" x="241.2" y="1956.3"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="253.2" y="1967.1547">alt</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="192" x="302.8" y="1966.4078">[Transfer.ilpCondition validate successful]</text><path d="M249.2,1975.7485 L614,1975.7485 L614,1981.3485 L606,1989.3485 L249.2,1989.3485 L249.2,1975.7485 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="147.0906" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1280.4" x="249.2" y="1975.7485"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="328.8" x="261.2" y="1986.6032">Persist Transfer State (with transferState='RECEIVED-FULFIL')</text><polygon fill="#A80036" points="1118.8,2015.1969,1126.8,2018.3969,1118.8,2021.5969,1122,2018.3969" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="1123.6" y1="2018.3969" y2="2018.3969"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="322.4" y="2008.9758">33</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="161.6" x="340" y="2002.8516">Request to persist transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.4" x="340" y="2015.1">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="401.6" y="2015.1">2003</text><polygon fill="#A80036" points="1447.6,2038.8938,1455.6,2042.0938,1447.6,2045.2938,1450.8,2042.0938" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="1136.4" x2="1452.4" y1="2042.0938" y2="2042.0938"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="1142" y="2038.5485">34</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="104" x="1159.6" y="2038.5485">Persist transfer state</text><polygon fill="#FFFFE0" filter="url(#fvoctuhfws6d3)" points="1408.8,2076.7422,1513.6,2076.7422,1521.6,2085.5422,1513.6,2095.1422,1408.8,2095.1422,1400.8,2085.5422,1408.8,2076.7422" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="101.6" x="1410.4" y="2089.9969">transferStateChange</text><polygon fill="#A80036" points="325.6,2112.9907,317.6,2116.1907,325.6,2119.3907,322.4,2116.1907" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="320.8" x2="1127.6" y1="2116.1907" y2="2116.1907"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="330.4" y="2112.6453">35</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="76" x="348" y="2112.6453">Return success</text><path d="M320.8,2132.4391 L320.8,2434.0391 L568,2434.0391 L568,2140.4391 L560,2132.4391 L320.8,2132.4391 " fill="#FFFF00" filter="url(#fvoctuhfws6d3)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M560,2132.4391 L560,2140.4391 L568,2140.4391 L560,2132.4391 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="46.4" x="325.6" y="2146.4938">Message:</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="325.6" y="2158.7422">{</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="46.4" x="338.4" y="2170.9907">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="206.4" x="338.4" y="2183.2391">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="217.6" x="338.4" y="2195.4875">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="114.4" x="338.4" y="2207.736">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="48" x="338.4" y="2219.9844">content: {</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="144.8" x="351.2" y="2232.2328">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="144" x="351.2" y="2244.4813">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="6.4" x="338.4" y="2256.7297">},</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="56" x="338.4" y="2268.9782">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="36.8" x="351.2" y="2281.2266">event: {</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="57.6" x="364" y="2293.475">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="152.8" x="364" y="2305.7235">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="364" y="2317.9719">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="79.2" x="364" y="2330.2203">action: commit,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="127.2" x="364" y="2342.4688">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="34.4" x="364" y="2354.7172">state: {</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="88.8" x="376.8" y="2366.9657">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="36.8" x="376.8" y="2379.2141">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="364" y="2391.4625">}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="351.2" y="2403.711">}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="338.4" y="2415.9594">}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="325.6" y="2428.2078">}</text><polygon fill="#A80036" points="785.6,2455.2016,793.6,2458.4016,785.6,2461.6016,788.8,2458.4016" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="790.4" y1="2458.4016" y2="2458.4016"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="322.4" y="2454.8563">36</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="202.4" x="340" y="2454.8563">Route &amp; Publish Position event for Payee</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="241.2" x2="1537.6" y1="2489.85" y2="2489.85"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="179.2" x="245.2" y="2498.3578">[Validate Fulfil Transfer not successful]</text><path d="M249.2,2506.6141 L316.4,2506.6141 L316.4,2512.2141 L308.4,2520.2141 L249.2,2520.2141 L249.2,2506.6141 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="61.2969" style="stroke: #000000; stroke-width: 1.600000023841858;" width="843.6" x="249.2" y="2506.6141"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="261.2" y="2517.4688">break</text><polygon fill="#A80036" points="1012.4,2534.0625,1020.4,2537.2625,1012.4,2540.4625,1015.6,2537.2625" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="316.8" x2="1017.2" y1="2537.2625" y2="2537.2625"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="322.4" y="2533.7172">37</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="221.6" x="340" y="2533.7172">Route &amp; Publish Notification event for Payee</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="18.4" x2="1593.6" y1="2585.511" y2="2585.511"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120.8" x="22.4" y="2594.0188">[Consume Batch Messages]</text><path d="M130.4,2600.675 L130.4,2620.675 L301.6,2620.675 L301.6,2608.675 L293.6,2600.675 L130.4,2600.675 " fill="#ADD8E6" filter="url(#fvoctuhfws6d3)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M293.6,2600.675 L293.6,2608.675 L301.6,2608.675 L293.6,2600.675 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="154.4" x="135.2" y="2614.7297">To be delivered by future story</text><!--
@startuml
title 2.1.1. Fulfil Handler Consume (Success)
autonumber
collections "Fulfil-Topic" as TOPIC_FULFIL
control "Fulfil Event Handler" as FULF_HANDLER
collections "Event-Topic" as TOPIC_EVENT
collections "Position-Topic-dfsp2" as TOPIC_POSITION_DFSP2
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Transfer DAO" as TRANS_DAO
database "Central Store" as DB
box "Central Service" #LightYellow
    participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_POSITION_DFSP2
    participant TOPIC_EVENT
    participant TOPIC_NOTIFICATIONS
    participant TRANS_DAO
    participant DB
end box
activate FULF_HANDLER
group Fulfil Handler Consume (Success)
    alt Consume Single Message
        TOPIC_FULFIL <- FULF_HANDLER: Consume Prepare event message for Payer
        activate TOPIC_FULFIL
        deactivate TOPIC_FULFIL
        break
            group Validate Event
                FULF_HANDLER <-> FULF_HANDLER: Validate event - Rule: type == 'fulfil' && action == 'commit'\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            FULF_HANDLER -> TOPIC_EVENT: Publish event information
            ref over FULF_HANDLER, TOPIC_EVENT:  Event Handler Consume {9.1.0.}
        end
        group Validate FSPIOP-Signature
            |||
            ref over FULF_HANDLER, TOPIC_NOTIFICATIONS: Validate message.content.headers.**FSPIOP-Signature** {seq-signature-validation} \n<color #FF0000><b>Error codes:</b> 2001</color>
        end
        group Validate Transfer Fulfilment Duplicate Check
            FULF_HANDLER -> FULF_HANDLER: Generate transferFulfilmentId uuid
            FULF_HANDLER -> TRANS_DAO: Request to retrieve transfer fulfilment hashes by transferId\n<color #FF0000><b>Error code:</b> 2003</color>
            activate TRANS_DAO
            TRANS_DAO -> DB: Request Transfer fulfilment duplicate message hashes
            hnote over DB #lightyellow
                SELET transferId, hash
                FROM **transferFulfilmentDuplicateCheck**
                WHERE transferId = request.params.id
            end note
            activate DB
            TRANS_DAO <- - DB: Return existing hashes
            deactivate DB
            TRANS_DAO - -> FULF_HANDLER: Return (list of) transfer fulfil messages hash(es)
            deactivate TRANS_DAO
            FULF_HANDLER -> FULF_HANDLER: Loop the list of returned hashes and compare each entry with the calculated message hash
            alt Hash matched
                FULF_HANDLER -> TRANS_DAO: Request to retrieve Transfer Fulfilment and Transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Request to retrieve Transfer Fulfilment and Transfer state
                hnote over DB #lightyellow
                    transferFulfilment
                    transferStateChange
                end note
                activate DB
                TRANS_DAO <- - DB: Return Transfer Fulfilment and Transfer state
                deactivate DB
                TRANS_DAO - -> FULF_HANDLER: Return Transfer Fulfilment and Transfer state
                deactivate TRANS_DAO
                alt transferFulfilment.isValid == 0
                    break
                        FULF_HANDLER <-> FULF_HANDLER: <color #FF0000><b>Error handling:</b> 3105</color>
                    end
                else transferState IN ['COMMITTED', 'ABORTED']
                    break
                        ref over FULF_HANDLER, TOPIC_NOTIFICATIONS: Send notification to Participant (Payee) {1.1.4.} \n
                    end
                else transferState NOT 'RESERVED'
                    break
                        FULF_HANDLER <-> FULF_HANDLER: <color #FF0000><b>Error code:</b> 2001</color>
                    end
                else
                    break
                        FULF_HANDLER <-> FULF_HANDLER: Allow previous request to complete
                    end
                end
            else Hash not matched
                FULF_HANDLER -> TRANS_DAO: Request to persist transfer hash\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist hash
                hnote over DB #lightyellow
                    transferFulfilmentDuplicateCheck
                end note
                activate DB
                deactivate DB
                TRANS_DAO - -> FULF_HANDLER: Return success
                deactivate TRANS_DAO
            end
        end
        group Validate and persist Transfer Fulfilment
            FULF_HANDLER -> TRANS_DAO: Request information for the validate checks\n<color #FF0000><b>Error code:</b> 2003</color>
            activate TRANS_DAO
            TRANS_DAO -> DB: Fetch from database
            activate DB
            hnote over DB #lightyellow
                transfer
            end note
            DB - -> TRANS_DAO
            deactivate DB
            FULF_HANDLER <- - TRANS_DAO: Return transfer
            deactivate TRANS_DAO
            FULF_HANDLER ->FULF_HANDLER: Validate that Transfer.ilpCondition = SHA-256 (content.payload.fulfilment)\n<color #FF0000><b>Error code:</b> 2001</color>
            FULF_HANDLER -> FULF_HANDLER: Validate expirationDate\n<color #FF0000><b>Error code:</b> 3303</color>

            opt Transfer.ilpCondition validate successful
                group Request current Settlement Window
                    FULF_HANDLER -> TRANS_DAO: Request to retrieve current/latest transfer settlement window\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Fetch settlementWindowId
                    activate DB
                    DB - -> TRANS_DAO
                    hnote over DB #lightyellow
                        settlementWindow
                    end note
                    deactivate DB
                    FULF_HANDLER <- - TRANS_DAO: Return settlementWindowId to be appended during transferFulfilment insert\n**TODO**: During settlement design make sure transfers in 'RECEIVED-FULFIL'\nstate are updated to the next settlement window
                    deactivate TRANS_DAO
                end
            end

            group Persist fulfilment
                FULF_HANDLER -> TRANS_DAO: Persist fulfilment with the result of the above check (transferFulfilment.isValid)\n<color #FF0000><b>Error code:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist to database
                activate DB
                deactivate DB
                hnote over DB #lightyellow
                    transferFulfilment
                    transferExtension
                end note
                FULF_HANDLER <- - TRANS_DAO: Return success
                deactivate TRANS_DAO
            end

            alt Transfer.ilpCondition validate successful
                group Persist Transfer State (with transferState='RECEIVED-FULFIL')
                    FULF_HANDLER -> TRANS_DAO: Request to persist transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Persist transfer state
                    activate DB
                    hnote over DB #lightyellow
                        transferStateChange
                    end note
                    deactivate DB
                    TRANS_DAO - -> FULF_HANDLER: Return success
                end



                note right of FULF_HANDLER #yellow
                    Message:
                    {
                        id: <ID>,
                        from: <transferHeaders.FSPIOP-Source>,
                        to: <transferHeaders.FSPIOP-Destination>,
                        type: application/json,
                        content: {
                            headers: <transferHeaders>,
                            payload: <transferMessage>
                        },
                        metadata: {
                            event: {
                                id: <uuid>,
                                responseTo: <previous.uuid>,
                                type: position,
                                action: commit,
                                createdAt: <timestamp>,
                                state: {
                                    status: "success",
                                    code: 0
                                }
                            }
                        }
                    }
                end note
                FULF_HANDLER -> TOPIC_POSITION_DFSP2: Route & Publish Position event for Payee
                activate TOPIC_POSITION_DFSP2
                deactivate TOPIC_POSITION_DFSP2
            else Validate Fulfil Transfer not successful
                break
                    FULF_HANDLER -> TOPIC_NOTIFICATIONS: Route & Publish Notification event for Payee
                    activate TOPIC_NOTIFICATIONS
                    deactivate TOPIC_NOTIFICATIONS
                end
            end
        end
    else Consume Batch Messages
        note left of FULF_HANDLER #lightblue
            To be delivered by future story
        end note
    end
end
deactivate FULF_HANDLER
@enduml

PlantUML version 1.2018.01(Sun Jan 28 20:08:22 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1136-b20
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>