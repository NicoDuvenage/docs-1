<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1423.2px" preserveAspectRatio="none" style="width:1400px;height:1423px;" version="1.1" viewBox="0 0 1400 1423" width="1400.8px" zoomAndPan="magnify"><defs><filter height="300%" id="f1d837upgn1ysy" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.600000023841858"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="3.200000047683716" dy="3.200000047683716" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="11.2" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286.4" x="558" y="18.8281">1.3.0 Position Handler Consume (single message)</text><rect fill="#FFFFE0" height="1387.2828" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="1356" x="23.2" y="27.5906"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80.8" x="660.8" y="37.6453">Central Service</text><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="127.2" y="145.5266"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="335.6" y="554.0172"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="537.2" y="962.5078"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="1275.8531" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="746.8" y="89.8297"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="1264.6531" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1381.6" x="10.4" y="95.4297"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="1239.6047" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1365.6" x="18.4" y="114.8781"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="84.9938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="419.6" x="687.2" y="181.775"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="59.9453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="403.6" x="695.2" y="201.2234"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="126.0422" style="stroke: #000000; stroke-width: 1.600000023841858;" width="454.4" x="695.2" y="277.9688"/><rect fill="#FFFFFF" height="408.4906" style="stroke: none; stroke-width: 0.800000011920929;" width="1365.6" x="18.4" y="525.2531"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="84.9938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="420.4" x="687.2" y="590.2656"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="59.9453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="404.4" x="695.2" y="609.7141"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="126.0422" style="stroke: #000000; stroke-width: 1.600000023841858;" width="454.4" x="695.2" y="686.4594"/><rect fill="#FFFFFF" height="420.7391" style="stroke: none; stroke-width: 0.800000011920929;" width="1365.6" x="18.4" y="933.7438"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="97.2422" style="stroke: #000000; stroke-width: 1.600000023841858;" width="327.6" x="687.2" y="998.7563"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="72.1938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="311.6" x="695.2" y="1018.2047"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="126.0422" style="stroke: #000000; stroke-width: 1.600000023841858;" width="454.4" x="695.2" y="1107.1985"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="131.2" x2="131.2" y1="81.8297" y2="1373.6828"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="339.2" x2="339.2" y1="81.8297" y2="1373.6828"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="540.8" x2="540.8" y1="81.8297" y2="1373.6828"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="750.4" x2="750.4" y1="81.8297" y2="1373.6828"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="1099.2" x2="1099.2" y1="81.8297" y2="1373.6828"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="1200" x2="1200" y1="81.8297" y2="1373.6828"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="1316.8" x2="1316.8" y1="81.8297" y2="1373.6828"/><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="203.2" x="29.6" y="50.2391"/><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="203.2" x="26.4" y="53.4391"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="192" x="32" y="69.8672">topic-usd-dfsp1-position-prepare</text><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="203.2" x="29.6" y="1372.8828"/><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="203.2" x="26.4" y="1376.0828"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="192" x="32" y="1392.511">topic-usd-dfsp1-position-prepare</text><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="184.8" x="247.2" y="50.2391"/><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="184.8" x="244" y="53.4391"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="173.6" x="249.6" y="69.8672">topic-usd-dfsp2-position-fulfil</text><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="184.8" x="247.2" y="1372.8828"/><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="184.8" x="244" y="1376.0828"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="173.6" x="249.6" y="1392.511">topic-usd-dfsp2-position-fulfil</text><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="189.6" x="446.4" y="50.2391"/><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="189.6" x="443.2" y="53.4391"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="178.4" x="448.8" y="69.8672">topic-usd-dfsp1-position-abort</text><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="189.6" x="446.4" y="1372.8828"/><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="189.6" x="443.2" y="1376.0828"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="178.4" x="448.8" y="1392.511">topic-usd-dfsp1-position-abort</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="90.4" x="703.2" y="79.4672">Position Handler</text><ellipse cx="750.8" cy="55.8391" fill="#FEFECE" filter="url(#f1d837upgn1ysy)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><polygon fill="#A80036" points="747.6,46.2391,752.4,42.2391,750.8,46.2391,752.4,50.2391,747.6,46.2391" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="90.4" x="703.2" y="1383.711">Position Handler</text><ellipse cx="750.8" cy="1398.8735" fill="#FEFECE" filter="url(#f1d837upgn1ysy)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><polygon fill="#A80036" points="747.6,1389.2735,752.4,1385.2735,750.8,1389.2735,752.4,1393.2735,747.6,1389.2735" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="77.6" x="1060.8" y="50.2391"/><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="77.6" x="1057.6" y="53.4391"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="66.4" x="1063.2" y="69.8672">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="77.6" x="1060.8" y="1372.8828"/><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="77.6" x="1057.6" y="1376.0828"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="66.4" x="1063.2" y="1392.511">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="94.4" x="1152.8" y="50.2391"/><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="94.4" x="1149.6" y="53.4391"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="83.2" x="1155.2" y="69.8672">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="94.4" x="1152.8" y="1372.8828"/><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="94.4" x="1149.6" y="1376.0828"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="83.2" x="1155.2" y="1392.511">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="1261.6" y="50.2391"/><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="1258.4" y="53.4391"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="1264" y="69.8672">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="1261.6" y="1372.8828"/><rect fill="#FEFECE" filter="url(#f1d837upgn1ysy)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="1258.4" y="1376.0828"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="1264" y="1392.511">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="127.2" y="145.5266"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="335.6" y="554.0172"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="537.2" y="962.5078"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="1275.8531" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="746.8" y="89.8297"/><path d="M10.4,95.4297 L188.8,95.4297 L188.8,101.0297 L180.8,109.0297 L10.4,109.0297 L10.4,95.4297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="1264.6531" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1381.6" x="10.4" y="95.4297"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142.4" x="22.4" y="106.2844">Position Handler Consume</text><path d="M18.4,114.8781 L68,114.8781 L68,120.4781 L60,128.4781 L18.4,128.4781 L18.4,114.8781 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="1239.6047" style="stroke: #000000; stroke-width: 1.600000023841858;" width="1365.6" x="18.4" y="114.8781"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="30.4" y="125.7328">alt</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170.4" x="80" y="124.9859">[Consume Prepare message for Payer]</text><polygon fill="#A80036" points="144,142.3266,136,145.5266,144,148.7266,140.8,145.5266" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="139.2" x2="746" y1="145.5266" y2="145.5266"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="148.8" y="141.9813">1</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="216" x="159.2" y="141.9813">Consume Position event message for Payer</text><path d="M687.2,181.775 L754.4,181.775 L754.4,187.375 L746.4,195.375 L687.2,195.375 L687.2,181.775 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="84.9938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="419.6" x="687.2" y="181.775"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="699.2" y="192.6297">break</text><path d="M695.2,201.2234 L808.8,201.2234 L808.8,206.8234 L800.8,214.8234 L695.2,214.8234 L695.2,201.2234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="59.9453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="403.6" x="695.2" y="201.2234"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77.6" x="707.2" y="212.0781">Validate Event</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="754.8" x2="788.4" y1="244.3688" y2="244.3688"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="788.4" x2="788.4" y1="244.3688" y2="254.7688"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="755.6" x2="788.4" y1="254.7688" y2="254.7688"/><polygon fill="#A80036" points="763.6,251.5688,755.6,254.7688,763.6,257.9688,760.4,254.7688" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="760.4" y="234.4508">2</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="318.4" x="770.8" y="228.3266">Validate event - Rule: type == 'position' &amp;&amp; action == 'prepare'</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="770.8" y="240.575">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="838" y="240.575">2001</text><path d="M695.2,277.9688 L867.2,277.9688 L867.2,283.5688 L859.2,291.5688 L695.2,291.5688 L695.2,277.9688 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="126.0422" style="stroke: #000000; stroke-width: 1.600000023841858;" width="454.4" x="695.2" y="277.9688"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="707.2" y="288.8234">Persist Event Information</text><polygon fill="#A80036" points="1090,325.4172,1098,328.6172,1090,331.8172,1093.2,328.6172" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="754.8" x2="1094.8" y1="328.6172" y2="328.6172"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="760.4" y="325.0719">3</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="129.6" x="770.8" y="325.0719">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="44.7453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="440" x="700.8" y="335.2656"/><polygon fill="#EEEEEE" points="700.8,335.2656,752,335.2656,752,340.8656,744,348.8656,700.8,348.8656,700.8,335.2656" style="stroke: #000000; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15.2" x="711.2" y="346.9203">ref</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="158.4" x="841.6" y="362.1203">Event Handler Consume {9.1.0.}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="844.8" y="374.3688"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="44.7453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="262.4" x="700.8" y="429.6109"/><polygon fill="#EEEEEE" points="700.8,429.6109,752,429.6109,752,435.2109,744,443.2109,700.8,443.2109,700.8,429.6109" style="stroke: #000000; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15.2" x="711.2" y="441.2656">ref</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="252.8" x="705.6" y="456.4656">Prepare Position Handler Consume {1.3.1-prepare}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="708.8" y="468.7141"/><polygon fill="#A80036" points="1190.4,491.9563,1198.4,495.1563,1190.4,498.3563,1193.6,495.1563" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="754.8" x2="1195.2" y1="495.1563" y2="495.1563"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="760.4" y="491.6109">4</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="87.2" x="770.8" y="491.6109">Produce message</text><polygon fill="#A80036" points="1307.6,515.4047,1315.6,518.6047,1307.6,521.8047,1310.8,518.6047" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="754.8" x2="1312.4" y1="518.6047" y2="518.6047"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="760.4" y="515.0594">5</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="87.2" x="770.8" y="515.0594">Produce message</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="18.4" x2="1384" y1="526.0531" y2="526.0531"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="161.6" x="22.4" y="534.5609">[Consume Fulfil message for Payee]</text><polygon fill="#A80036" points="352.4,550.8172,344.4,554.0172,352.4,557.2172,349.2,554.0172" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="347.6" x2="746" y1="554.0172" y2="554.0172"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="357.2" y="550.4719">6</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="217.6" x="367.6" y="550.4719">Consume Position event message for Payee</text><path d="M687.2,590.2656 L754.4,590.2656 L754.4,595.8656 L746.4,603.8656 L687.2,603.8656 L687.2,590.2656 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="84.9938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="420.4" x="687.2" y="590.2656"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="699.2" y="601.1203">break</text><path d="M695.2,609.7141 L808.8,609.7141 L808.8,615.3141 L800.8,623.3141 L695.2,623.3141 L695.2,609.7141 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="59.9453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="404.4" x="695.2" y="609.7141"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77.6" x="707.2" y="620.5688">Validate Event</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="754.8" x2="788.4" y1="652.8594" y2="652.8594"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="788.4" x2="788.4" y1="652.8594" y2="663.2594"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="755.6" x2="788.4" y1="663.2594" y2="663.2594"/><polygon fill="#A80036" points="763.6,660.0594,755.6,663.2594,763.6,666.4594,760.4,663.2594" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="760.4" y="642.9414">7</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="319.2" x="770.8" y="636.8172">Validate event - Rule: type == 'position' &amp;&amp; action == 'commit'</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="770.8" y="649.0656">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="838" y="649.0656">2001</text><path d="M695.2,686.4594 L867.2,686.4594 L867.2,692.0594 L859.2,700.0594 L695.2,700.0594 L695.2,686.4594 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="126.0422" style="stroke: #000000; stroke-width: 1.600000023841858;" width="454.4" x="695.2" y="686.4594"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="707.2" y="697.3141">Persist Event Information</text><polygon fill="#A80036" points="1090,733.9078,1098,737.1078,1090,740.3078,1093.2,737.1078" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="754.8" x2="1094.8" y1="737.1078" y2="737.1078"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="760.4" y="733.5625">8</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="129.6" x="770.8" y="733.5625">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="44.7453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="440" x="700.8" y="743.7563"/><polygon fill="#EEEEEE" points="700.8,743.7563,752,743.7563,752,749.3563,744,757.3563,700.8,757.3563,700.8,743.7563" style="stroke: #000000; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15.2" x="711.2" y="755.4109">ref</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="158.4" x="841.6" y="770.6109">Event Handler Consume {9.1.0.}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="844.8" y="782.8594"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="44.7453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="237.6" x="700.8" y="838.1016"/><polygon fill="#EEEEEE" points="700.8,838.1016,752,838.1016,752,843.7016,744,851.7016,700.8,851.7016,700.8,838.1016" style="stroke: #000000; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15.2" x="711.2" y="849.7563">ref</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="228" x="705.6" y="864.9563">Fulfil Position Handler Consume {1.3.2-fulfil}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="708.8" y="877.2047"/><polygon fill="#A80036" points="1190.4,900.4469,1198.4,903.6469,1190.4,906.8469,1193.6,903.6469" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="754.8" x2="1195.2" y1="903.6469" y2="903.6469"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="760.4" y="900.1016">9</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="87.2" x="770.8" y="900.1016">Produce message</text><polygon fill="#A80036" points="1307.6,923.8953,1315.6,927.0953,1307.6,930.2953,1310.8,927.0953" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="754.8" x2="1312.4" y1="927.0953" y2="927.0953"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="760.4" y="923.55">10</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="87.2" x="778" y="923.55">Produce message</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="18.4" x2="1384" y1="934.5438" y2="934.5438"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="117.6" x="22.4" y="943.0516">[Consume Abort message]</text><polygon fill="#A80036" points="554,959.3078,546,962.5078,554,965.7078,550.8,962.5078" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="549.2" x2="746" y1="962.5078" y2="962.5078"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="558.8" y="958.9625">11</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="168.8" x="576.4" y="958.9625">Consume Position event message</text><path d="M687.2,998.7563 L754.4,998.7563 L754.4,1004.3563 L746.4,1012.3563 L687.2,1012.3563 L687.2,998.7563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="97.2422" style="stroke: #000000; stroke-width: 1.600000023841858;" width="327.6" x="687.2" y="998.7563"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="699.2" y="1009.611">break</text><path d="M695.2,1018.2047 L808.8,1018.2047 L808.8,1023.8047 L800.8,1031.8047 L695.2,1031.8047 L695.2,1018.2047 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="72.1938" style="stroke: #000000; stroke-width: 1.600000023841858;" width="311.6" x="695.2" y="1018.2047"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77.6" x="707.2" y="1029.0594">Validate Event</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="754.8" x2="788.4" y1="1073.5985" y2="1073.5985"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="788.4" x2="788.4" y1="1073.5985" y2="1083.9985"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="755.6" x2="788.4" y1="1083.9985" y2="1083.9985"/><polygon fill="#A80036" points="763.6,1080.7985,755.6,1083.9985,763.6,1087.1985,760.4,1083.9985" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="760.4" y="1057.5563">12</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="219.2" x="778" y="1045.3078">Validate event - Rule: type == 'position' &amp;&amp;</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="214.4" x="778" y="1057.5563">action IN ['timeout-reserved', 'reject', 'fail']</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="778" y="1069.8047">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="25.6" x="845.2" y="1069.8047">2001</text><path d="M695.2,1107.1985 L867.2,1107.1985 L867.2,1112.7985 L859.2,1120.7985 L695.2,1120.7985 L695.2,1107.1985 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="126.0422" style="stroke: #000000; stroke-width: 1.600000023841858;" width="454.4" x="695.2" y="1107.1985"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="707.2" y="1118.0531">Persist Event Information</text><polygon fill="#A80036" points="1090,1154.6469,1098,1157.8469,1090,1161.0469,1093.2,1157.8469" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="754.8" x2="1094.8" y1="1157.8469" y2="1157.8469"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="760.4" y="1154.3016">13</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="129.6" x="778" y="1154.3016">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="44.7453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="440" x="700.8" y="1164.4953"/><polygon fill="#EEEEEE" points="700.8,1164.4953,752,1164.4953,752,1170.0953,744,1178.0953,700.8,1178.0953,700.8,1164.4953" style="stroke: #000000; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15.2" x="711.2" y="1176.15">ref</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="158.4" x="841.6" y="1191.35">Event Handler Consume {9.1.0.}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="844.8" y="1203.5985"/><rect fill="#FFFFFF" filter="url(#f1d837upgn1ysy)" height="44.7453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="242.4" x="700.8" y="1258.8406"/><polygon fill="#EEEEEE" points="700.8,1258.8406,752,1258.8406,752,1264.4406,744,1272.4406,700.8,1272.4406,700.8,1258.8406" style="stroke: #000000; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15.2" x="711.2" y="1270.4953">ref</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="232.8" x="705.6" y="1285.6953">Abort Position Handler Consume {1.3.3-abort}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="708.8" y="1297.9438"/><polygon fill="#A80036" points="1190.4,1321.186,1198.4,1324.386,1190.4,1327.586,1193.6,1324.386" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="754.8" x2="1195.2" y1="1324.386" y2="1324.386"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="760.4" y="1320.8406">14</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="87.2" x="778" y="1320.8406">Produce message</text><polygon fill="#A80036" points="1307.6,1344.6344,1315.6,1347.8344,1307.6,1351.0344,1310.8,1347.8344" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="754.8" x2="1312.4" y1="1347.8344" y2="1347.8344"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="760.4" y="1344.2891">15</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="87.2" x="778" y="1344.2891">Produce message</text><!--
@startuml
title 1.3.0 Position Handler Consume (single message)

autonumber


collections "topic-usd-dfsp1-position-prepare" as TOPIC_POSITION_PREPARE_DFSP1
collections "topic-usd-dfsp2-position-fulfil" as TOPIC_POSITION_FULFIL_DFSP2
collections "topic-usd-dfsp1-position-abort" as TOPIC_POSITION_ABORT_DFSP1
control "Position Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
collections "Event-Topic" as TOPIC_EVENTS
collections "Notification-Topic" as TOPIC_NOTIFICATIONS

box "Central Service" #LightYellow
    participant TOPIC_POSITION_PREPARE_DFSP1
    participant TOPIC_POSITION_FULFIL_DFSP2
    participant TOPIC_POSITION_ABORT_DFSP1
    participant POS_HANDLER
    participant TOPIC_EVENTS
    participant TOPIC_TRANSFERS
    participant TOPIC_NOTIFICATIONS
end box

activate POS_HANDLER
group Position Handler Consume
    alt Consume Prepare message for Payer
        TOPIC_POSITION_PREPARE_DFSP1 <- POS_HANDLER: Consume Position event message for Payer
        activate TOPIC_POSITION_PREPARE_DFSP1
        deactivate TOPIC_POSITION_PREPARE_DFSP1
        break
            group Validate Event
                POS_HANDLER <-> POS_HANDLER: Validate event - Rule: type == 'position' && action == 'prepare'\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            |||
            POS_HANDLER -> TOPIC_EVENTS: Publish event information
            ref over POS_HANDLER, TOPIC_EVENTS :  Event Handler Consume {9.1.0.} \n
            |||
        end
        |||
        ref over POS_HANDLER: Prepare Position Handler Consume {1.3.1-prepare} \n
        POS_HANDLER -> TOPIC_TRANSFERS: Produce message
        POS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    else Consume Fulfil message for Payee
        TOPIC_POSITION_FULFIL_DFSP2 <- POS_HANDLER: Consume Position event message for Payee
        activate TOPIC_POSITION_FULFIL_DFSP2
        deactivate TOPIC_POSITION_FULFIL_DFSP2
        break
            group Validate Event
                POS_HANDLER <-> POS_HANDLER: Validate event - Rule: type == 'position' && action == 'commit'\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            |||
            POS_HANDLER -> TOPIC_EVENTS: Publish event information
            ref over POS_HANDLER, TOPIC_EVENTS :  Event Handler Consume {9.1.0.} \n
            |||
        end
        |||
        ref over POS_HANDLER: Fulfil Position Handler Consume {1.3.2-fulfil} \n
        POS_HANDLER -> TOPIC_TRANSFERS: Produce message
        POS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    else Consume Abort message
        TOPIC_POSITION_ABORT_DFSP1 <- POS_HANDLER: Consume Position event message
        activate TOPIC_POSITION_ABORT_DFSP1
        deactivate TOPIC_POSITION_ABORT_DFSP1
        break
            group Validate Event
                POS_HANDLER <-> POS_HANDLER: Validate event - Rule: type == 'position' &&\naction IN ['timeout-reserved', 'reject', 'fail']\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            |||
            POS_HANDLER -> TOPIC_EVENTS: Publish event information
            ref over POS_HANDLER, TOPIC_EVENTS :  Event Handler Consume {9.1.0.} \n
            |||
        end
        |||
        ref over POS_HANDLER: Abort Position Handler Consume {1.3.3-abort} \n
        POS_HANDLER -> TOPIC_TRANSFERS: Produce message
        POS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    end

end
deactivate POS_HANDLER
@enduml

PlantUML version 1.2018.01(Sun Jan 28 20:08:22 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1136-b20
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>