<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1779px" preserveAspectRatio="none" style="width:1668px;height:1779px;" version="1.1" viewBox="0 0 1668 1779" width="1668px" zoomAndPan="magnify"><defs><filter height="300%" id="f14qa4f8fg8r8n" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="358" x="656.25" y="23.5352">1.3.0 Position Handler Consume (single message)</text><rect fill="#FFFFE0" height="1734.1035" style="stroke: #A80036; stroke-width: 1.0;" width="1612.5" x="29" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="784.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="142.5" y="181.9082"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="370" y="692.5215"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="589" y="1203.1348"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="1594.8164" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="851" y="112.2871"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="1580.8164" style="stroke: #000000; stroke-width: 2.0;" width="1644.5" x="13" y="119.2871"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="1549.5059" style="stroke: #000000; stroke-width: 2.0;" width="1624.5" x="23" y="143.5977"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="524.5" x="776.5" y="227.2188"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="504.5" x="786.5" y="251.5293"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="568" x="786.5" y="347.4609"/><rect fill="#FFFFFF" height="510.6133" style="stroke: none; stroke-width: 1.0;" width="1624.5" x="23" y="656.5664"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="525.5" x="776.5" y="737.832"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="505.5" x="786.5" y="762.1426"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="568" x="786.5" y="858.0742"/><rect fill="#FFFFFF" height="525.9238" style="stroke: none; stroke-width: 1.0;" width="1624.5" x="23" y="1167.1797"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="121.5527" style="stroke: #000000; stroke-width: 2.0;" width="409.5" x="776.5" y="1248.4453"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="90.2422" style="stroke: #000000; stroke-width: 2.0;" width="389.5" x="786.5" y="1272.7559"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="568" x="786.5" y="1383.998"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="147" x2="147" y1="102.2871" y2="1717.1035"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="375" x2="375" y1="102.2871" y2="1717.1035"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="594" x2="594" y1="102.2871" y2="1717.1035"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="855.5" x2="855.5" y1="102.2871" y2="1717.1035"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1291.5" x2="1291.5" y1="102.2871" y2="1717.1035"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1417.5" x2="1417.5" y1="102.2871" y2="1717.1035"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1563.5" x2="1563.5" y1="102.2871" y2="1717.1035"/><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="37" y="62.7988"/><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="33" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="207" x="40" y="87.334">topic-dfsp1-position-prepare</text><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="37" y="1716.1035"/><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="221" x="33" y="1720.1035"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="207" x="40" y="1740.6387">topic-dfsp1-position-prepare</text><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="198" x="276" y="62.7988"/><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="198" x="272" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="184" x="279" y="87.334">topic-dfsp2-position-fulfil</text><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="198" x="276" y="1716.1035"/><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="198" x="272" y="1720.1035"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="184" x="279" y="1740.6387">topic-dfsp2-position-fulfil</text><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="204" x="492" y="62.7988"/><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="204" x="488" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="190" x="495" y="87.334">topic-dfsp1-position-abort</text><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="204" x="492" y="1716.1035"/><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="204" x="488" y="1720.1035"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="190" x="495" y="1740.6387">topic-dfsp1-position-abort</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="796.5" y="99.334">Position Handler</text><ellipse cx="856" cy="69.7988" fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="852,57.7988,858,52.7988,856,57.7988,858,62.7988,852,57.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="796.5" y="1729.6387">Position Handler</text><ellipse cx="856" cy="1748.5918" fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="852,1736.5918,858,1731.5918,856,1736.5918,858,1741.5918,852,1736.5918" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1243.5" y="62.7988"/><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1239.5" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1246.5" y="87.334">Event-Topic</text><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1243.5" y="1716.1035"/><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1239.5" y="1720.1035"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1246.5" y="1740.6387">Event-Topic</text><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="1358.5" y="62.7988"/><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="1354.5" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="1361.5" y="87.334">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="1358.5" y="1716.1035"/><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="1354.5" y="1720.1035"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="1361.5" y="1740.6387">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1494.5" y="62.7988"/><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1490.5" y="66.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1497.5" y="87.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1494.5" y="1716.1035"/><rect fill="#FEFECE" filter="url(#f14qa4f8fg8r8n)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1490.5" y="1720.1035"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1497.5" y="1740.6387">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="142.5" y="181.9082"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="370" y="692.5215"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="589" y="1203.1348"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="1594.8164" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="851" y="112.2871"/><path d="M13,119.2871 L236,119.2871 L236,126.2871 L226,136.2871 L13,136.2871 L13,119.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1580.8164" style="stroke: #000000; stroke-width: 2.0;" width="1644.5" x="13" y="119.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="28" y="132.8555">Position Handler Consume</text><path d="M23,143.5977 L85,143.5977 L85,150.5977 L75,160.5977 L23,160.5977 L23,143.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1549.5059" style="stroke: #000000; stroke-width: 2.0;" width="1624.5" x="23" y="143.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="157.166">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="213" x="100" y="156.2324">[Consume Prepare message for Payer]</text><polygon fill="#A80036" points="163.5,177.9082,153.5,181.9082,163.5,185.9082,159.5,181.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="157.5" x2="850" y1="181.9082" y2="181.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="169.5" y="177.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="182.5" y="177.4766">Consume Position event message for Payer</text><path d="M776.5,227.2188 L860.5,227.2188 L860.5,234.2188 L850.5,244.2188 L776.5,244.2188 L776.5,227.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="524.5" x="776.5" y="227.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="791.5" y="240.7871">break</text><path d="M786.5,251.5293 L928.5,251.5293 L928.5,258.5293 L918.5,268.5293 L786.5,268.5293 L786.5,251.5293 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="504.5" x="786.5" y="251.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="801.5" y="265.0977">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="903" y1="305.4609" y2="305.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="903" x2="903" y1="305.4609" y2="318.4609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="862" x2="903" y1="318.4609" y2="318.4609"/><polygon fill="#A80036" points="872,314.4609,862,318.4609,872,322.4609,868,318.4609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="868" y="293.0635">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="398" x="881" y="285.4082">Validate event - Rule: type == 'position' &amp;&amp; action == 'prepare'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="881" y="300.7188">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="965" y="300.7188">2001</text><path d="M786.5,347.4609 L1001.5,347.4609 L1001.5,354.4609 L991.5,364.4609 L786.5,364.4609 L786.5,347.4609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="568" x="786.5" y="347.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="801.5" y="361.0293">Persist Event Information</text><polygon fill="#A80036" points="1280,406.7715,1290,410.7715,1280,414.7715,1284,410.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="1286" y1="410.7715" y2="410.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="868" y="406.3398">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="881" y="406.3398">Publish event information</text><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="550" x="793.5" y="419.082"/><polygon fill="#EEEEEE" points="793.5,419.082,857.5,419.082,857.5,426.082,847.5,436.082,793.5,436.082,793.5,419.082" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="806.5" y="433.6504">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="969.5" y="452.6504">Event Handler Consume {9.1.0.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="973.5" y="467.9609"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="328" x="793.5" y="537.0137"/><polygon fill="#EEEEEE" points="793.5,537.0137,857.5,537.0137,857.5,544.0137,847.5,554.0137,793.5,554.0137,793.5,537.0137" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="806.5" y="551.582">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="799.5" y="570.582">Prepare Position Handler Consume {1.3.1-prepare}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="803.5" y="585.8926"/><polygon fill="#A80036" points="1405.5,614.9453,1415.5,618.9453,1405.5,622.9453,1409.5,618.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="1411.5" y1="618.9453" y2="618.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="868" y="614.5137">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="881" y="614.5137">Produce message</text><polygon fill="#A80036" points="1552,644.2559,1562,648.2559,1552,652.2559,1556,648.2559" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="1558" y1="648.2559" y2="648.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="868" y="643.8242">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="881" y="643.8242">Produce message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1647.5" y1="657.5664" y2="657.5664"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="202" x="28" y="668.2012">[Consume Fulfil message for Payee]</text><polygon fill="#A80036" points="391,688.5215,381,692.5215,391,696.5215,387,692.5215" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="385" x2="850" y1="692.5215" y2="692.5215"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="397" y="688.0898">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="410" y="688.0898">Consume Position event message for Payee</text><path d="M776.5,737.832 L860.5,737.832 L860.5,744.832 L850.5,754.832 L776.5,754.832 L776.5,737.832 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.2422" style="stroke: #000000; stroke-width: 2.0;" width="525.5" x="776.5" y="737.832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="791.5" y="751.4004">break</text><path d="M786.5,762.1426 L928.5,762.1426 L928.5,769.1426 L918.5,779.1426 L786.5,779.1426 L786.5,762.1426 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.9316" style="stroke: #000000; stroke-width: 2.0;" width="505.5" x="786.5" y="762.1426"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="801.5" y="775.7109">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="903" y1="816.0742" y2="816.0742"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="903" x2="903" y1="816.0742" y2="829.0742"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="862" x2="903" y1="829.0742" y2="829.0742"/><polygon fill="#A80036" points="872,825.0742,862,829.0742,872,833.0742,868,829.0742" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="868" y="803.6768">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="399" x="881" y="796.0215">Validate event - Rule: type == 'position' &amp;&amp; action == 'commit'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="881" y="811.332">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="965" y="811.332">2001</text><path d="M786.5,858.0742 L1001.5,858.0742 L1001.5,865.0742 L991.5,875.0742 L786.5,875.0742 L786.5,858.0742 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="568" x="786.5" y="858.0742"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="801.5" y="871.6426">Persist Event Information</text><polygon fill="#A80036" points="1280,917.3848,1290,921.3848,1280,925.3848,1284,921.3848" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="1286" y1="921.3848" y2="921.3848"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="868" y="916.9531">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="881" y="916.9531">Publish event information</text><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="550" x="793.5" y="929.6953"/><polygon fill="#EEEEEE" points="793.5,929.6953,857.5,929.6953,857.5,936.6953,847.5,946.6953,793.5,946.6953,793.5,929.6953" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="806.5" y="944.2637">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="969.5" y="963.2637">Event Handler Consume {9.1.0.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="973.5" y="978.5742"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="297" x="793.5" y="1047.627"/><polygon fill="#EEEEEE" points="793.5,1047.627,857.5,1047.627,857.5,1054.627,847.5,1064.627,793.5,1064.627,793.5,1047.627" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="806.5" y="1062.1953">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="799.5" y="1081.1953">Fulfil Position Handler Consume {1.3.2-fulfil}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="803.5" y="1096.5059"/><polygon fill="#A80036" points="1405.5,1125.5586,1415.5,1129.5586,1405.5,1133.5586,1409.5,1129.5586" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="1411.5" y1="1129.5586" y2="1129.5586"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="868" y="1125.127">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="881" y="1125.127">Produce message</text><polygon fill="#A80036" points="1552,1154.8691,1562,1158.8691,1552,1162.8691,1556,1158.8691" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="1558" y1="1158.8691" y2="1158.8691"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="868" y="1154.4375">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="890" y="1154.4375">Produce message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1647.5" y1="1168.1797" y2="1168.1797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="147" x="28" y="1178.8145">[Consume Abort message]</text><polygon fill="#A80036" points="610,1199.1348,600,1203.1348,610,1207.1348,606,1203.1348" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="604" x2="850" y1="1203.1348" y2="1203.1348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="616" y="1198.7031">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="638" y="1198.7031">Consume Position event message</text><path d="M776.5,1248.4453 L860.5,1248.4453 L860.5,1255.4453 L850.5,1265.4453 L776.5,1265.4453 L776.5,1248.4453 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="121.5527" style="stroke: #000000; stroke-width: 2.0;" width="409.5" x="776.5" y="1248.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="791.5" y="1262.0137">break</text><path d="M786.5,1272.7559 L928.5,1272.7559 L928.5,1279.7559 L918.5,1289.7559 L786.5,1289.7559 L786.5,1272.7559 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.2422" style="stroke: #000000; stroke-width: 2.0;" width="389.5" x="786.5" y="1272.7559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="801.5" y="1286.3242">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="903" y1="1341.998" y2="1341.998"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="903" x2="903" y1="1341.998" y2="1354.998"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="862" x2="903" y1="1354.998" y2="1354.998"/><polygon fill="#A80036" points="872,1350.998,862,1354.998,872,1358.998,868,1354.998" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="868" y="1321.9453">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="890" y="1306.6348">Validate event - Rule: type == 'position' &amp;&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="890" y="1321.9453">action IN ['timeout-reserved', 'reject', 'fail']</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="890" y="1337.2559">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="974" y="1337.2559">2001</text><path d="M786.5,1383.998 L1001.5,1383.998 L1001.5,1390.998 L991.5,1400.998 L786.5,1400.998 L786.5,1383.998 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="568" x="786.5" y="1383.998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="801.5" y="1397.5664">Persist Event Information</text><polygon fill="#A80036" points="1280,1443.3086,1290,1447.3086,1280,1451.3086,1284,1447.3086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="1286" y1="1447.3086" y2="1447.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="868" y="1442.877">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="890" y="1442.877">Publish event information</text><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="550" x="793.5" y="1455.6191"/><polygon fill="#EEEEEE" points="793.5,1455.6191,857.5,1455.6191,857.5,1462.6191,847.5,1472.6191,793.5,1472.6191,793.5,1455.6191" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="806.5" y="1470.1875">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="969.5" y="1489.1875">Event Handler Consume {9.1.0.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="973.5" y="1504.498"/><rect fill="#FFFFFF" filter="url(#f14qa4f8fg8r8n)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="303" x="793.5" y="1573.5508"/><polygon fill="#EEEEEE" points="793.5,1573.5508,857.5,1573.5508,857.5,1580.5508,847.5,1590.5508,793.5,1590.5508,793.5,1573.5508" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="806.5" y="1588.1191">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="291" x="799.5" y="1607.1191">Abort Position Handler Consume {1.3.3-abort}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="803.5" y="1622.4297"/><polygon fill="#A80036" points="1405.5,1651.4824,1415.5,1655.4824,1405.5,1659.4824,1409.5,1655.4824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="1411.5" y1="1655.4824" y2="1655.4824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="868" y="1651.0508">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="890" y="1651.0508">Produce message</text><polygon fill="#A80036" points="1552,1680.793,1562,1684.793,1552,1688.793,1556,1684.793" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="1558" y1="1684.793" y2="1684.793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="868" y="1680.3613">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="890" y="1680.3613">Produce message</text><!--
@startuml
title 1.3.0 Position Handler Consume (single message)

autonumber


collections "topic-dfsp1-position-prepare" as TOPIC_POSITION_PREPARE_DFSP1
collections "topic-dfsp2-position-fulfil" as TOPIC_POSITION_FULFIL_DFSP2
collections "topic-dfsp1-position-abort" as TOPIC_POSITION_ABORT_DFSP1
control "Position Handler" as POS_HANDLER
collections "Transfer-Topic" as TOPIC_TRANSFERS
collections "Event-Topic" as TOPIC_EVENTS
collections "Notification-Topic" as TOPIC_NOTIFICATIONS

box "Central Service" #LightYellow
    participant TOPIC_POSITION_PREPARE_DFSP1
    participant TOPIC_POSITION_FULFIL_DFSP2
    participant TOPIC_POSITION_ABORT_DFSP1
    participant POS_HANDLER
    participant TOPIC_EVENTS
    participant TOPIC_TRANSFERS
    participant TOPIC_NOTIFICATIONS
end box

activate POS_HANDLER
group Position Handler Consume
    alt Consume Prepare message for Payer
        TOPIC_POSITION_PREPARE_DFSP1 <- POS_HANDLER: Consume Position event message for Payer
        activate TOPIC_POSITION_PREPARE_DFSP1
        deactivate TOPIC_POSITION_PREPARE_DFSP1
        break
            group Validate Event
                POS_HANDLER <-> POS_HANDLER: Validate event - Rule: type == 'position' && action == 'prepare'\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            |||
            POS_HANDLER -> TOPIC_EVENTS: Publish event information
            ref over POS_HANDLER, TOPIC_EVENTS :  Event Handler Consume {9.1.0.} \n
            |||
        end
        |||
        ref over POS_HANDLER: Prepare Position Handler Consume {1.3.1-prepare} \n
        POS_HANDLER -> TOPIC_TRANSFERS: Produce message
        POS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    else Consume Fulfil message for Payee
        TOPIC_POSITION_FULFIL_DFSP2 <- POS_HANDLER: Consume Position event message for Payee
        activate TOPIC_POSITION_FULFIL_DFSP2
        deactivate TOPIC_POSITION_FULFIL_DFSP2
        break
            group Validate Event
                POS_HANDLER <-> POS_HANDLER: Validate event - Rule: type == 'position' && action == 'commit'\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            |||
            POS_HANDLER -> TOPIC_EVENTS: Publish event information
            ref over POS_HANDLER, TOPIC_EVENTS :  Event Handler Consume {9.1.0.} \n
            |||
        end
        |||
        ref over POS_HANDLER: Fulfil Position Handler Consume {1.3.2-fulfil} \n
        POS_HANDLER -> TOPIC_TRANSFERS: Produce message
        POS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    else Consume Abort message
        TOPIC_POSITION_ABORT_DFSP1 <- POS_HANDLER: Consume Position event message
        activate TOPIC_POSITION_ABORT_DFSP1
        deactivate TOPIC_POSITION_ABORT_DFSP1
        break
            group Validate Event
                POS_HANDLER <-> POS_HANDLER: Validate event - Rule: type == 'position' &&\naction IN ['timeout-reserved', 'reject', 'fail']\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            |||
            POS_HANDLER -> TOPIC_EVENTS: Publish event information
            ref over POS_HANDLER, TOPIC_EVENTS :  Event Handler Consume {9.1.0.} \n
            |||
        end
        |||
        ref over POS_HANDLER: Abort Position Handler Consume {1.3.3-abort} \n
        POS_HANDLER -> TOPIC_TRANSFERS: Produce message
        POS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    end

end
deactivate POS_HANDLER
@enduml

PlantUML version 1.2018.01(Sun Jan 28 20:08:22 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1136-b20
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>