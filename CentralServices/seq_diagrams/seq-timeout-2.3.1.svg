<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1643px" preserveAspectRatio="none" style="width:1061px;height:1643px;" version="1.1" viewBox="0 0 1061 1643" width="1061px" zoomAndPan="magnify"><defs><filter height="300%" id="f159bje2e7gssk" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="235" x="414" y="23.5352">2.3.1. Timeout Handler Consume</text><rect fill="#FFFFE0" height="1597.9805" style="stroke: #A80036; stroke-width: 1.0;" width="968" x="39" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="472.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="1431.6934" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="129.5" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="363.5" y="1504.6699"/><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="532" y="1047.2617"/><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="136.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="780" y="317.1504"/><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="950" y="346.7715"/><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="1416.6934" style="stroke: #000000; stroke-width: 2.0;" width="1037" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="92.2422" style="stroke: #000000; stroke-width: 2.0;" width="702.5" x="33" y="157.5977"/><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="198.4844" style="stroke: #000000; stroke-width: 2.0;" width="1007" x="33" y="263.8398"/><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="1066.6563" style="stroke: #000000; stroke-width: 2.0;" width="738" x="23" y="476.3242"/><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="951.0352" style="stroke: #000000; stroke-width: 2.0;" width="718" x="33" y="525.6348"/><rect fill="#FFFFFF" height="391.0977" style="stroke: none; stroke-width: 1.0;" width="718" x="33" y="1085.5723"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="134" x2="134" y1="116.2871" y2="1566.9805"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="368.5" x2="368.5" y1="116.2871" y2="1566.9805"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="536.5" x2="536.5" y1="116.2871" y2="1566.9805"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="672.5" x2="672.5" y1="116.2871" y2="1566.9805"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="784.5" x2="784.5" y1="116.2871" y2="1566.9805"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="955" x2="955" y1="116.2871" y2="1566.9805"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="177" x="43" y="113.334">Transfer Timeout Handler</text><ellipse cx="134.5" cy="83.7988" fill="#FEFECE" filter="url(#f159bje2e7gssk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="130.5,71.7988,136.5,66.7988,134.5,71.7988,136.5,76.7988,130.5,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="177" x="43" y="1579.5156">Transfer Timeout Handler</text><ellipse cx="134.5" cy="1598.4688" fill="#FEFECE" filter="url(#f159bje2e7gssk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="130.5,1586.4688,136.5,1581.4688,134.5,1586.4688,136.5,1591.4688,130.5,1586.4688" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f159bje2e7gssk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="287.5" y="76.7988"/><rect fill="#FEFECE" filter="url(#f159bje2e7gssk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="283.5" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="290.5" y="101.334">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f159bje2e7gssk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="287.5" y="1565.9805"/><rect fill="#FEFECE" filter="url(#f159bje2e7gssk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="283.5" y="1569.9805"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="290.5" y="1590.5156">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f159bje2e7gssk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="467.5" y="76.7988"/><rect fill="#FEFECE" filter="url(#f159bje2e7gssk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="463.5" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="470.5" y="101.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f159bje2e7gssk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="467.5" y="1565.9805"/><rect fill="#FEFECE" filter="url(#f159bje2e7gssk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="463.5" y="1569.9805"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="470.5" y="1590.5156">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f159bje2e7gssk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="624.5" y="76.7988"/><rect fill="#FEFECE" filter="url(#f159bje2e7gssk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="620.5" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="627.5" y="101.334">Event-Topic</text><rect fill="#FEFECE" filter="url(#f159bje2e7gssk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="624.5" y="1565.9805"/><rect fill="#FEFECE" filter="url(#f159bje2e7gssk)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="620.5" y="1569.9805"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="627.5" y="1590.5156">Event-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="735.5" y="113.334">Transfer DAO</text><ellipse cx="785" cy="83.7988" fill="#FEFECE" filter="url(#f159bje2e7gssk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="773" x2="797" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="735.5" y="1579.5156">Transfer DAO</text><ellipse cx="785" cy="1598.4688" fill="#FEFECE" filter="url(#f159bje2e7gssk)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="773" x2="797" y1="1612.4688" y2="1612.4688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="907" y="113.334">Central Store</text><path d="M937,63.7988 C937,53.7988 955,53.7988 955,53.7988 C955,53.7988 973,53.7988 973,63.7988 L973,89.7988 C973,99.7988 955,99.7988 955,99.7988 C955,99.7988 937,99.7988 937,89.7988 L937,63.7988 " fill="#FEFECE" filter="url(#f159bje2e7gssk)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M937,63.7988 C937,73.7988 955,73.7988 955,73.7988 C955,73.7988 973,73.7988 973,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="907" y="1579.5156">Central Store</text><path d="M937,1592.4688 C937,1582.4688 955,1582.4688 955,1582.4688 C955,1582.4688 973,1582.4688 973,1592.4688 L973,1618.4688 C973,1628.4688 955,1628.4688 955,1628.4688 C955,1628.4688 937,1628.4688 937,1618.4688 L937,1592.4688 " fill="#FEFECE" filter="url(#f159bje2e7gssk)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M937,1592.4688 C937,1602.4688 955,1602.4688 955,1602.4688 C955,1602.4688 973,1602.4688 973,1592.4688 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="1431.6934" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="129.5" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="363.5" y="1504.6699"/><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="532" y="1047.2617"/><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="136.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="780" y="317.1504"/><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="950" y="346.7715"/><path d="M13,133.2871 L239,133.2871 L239,140.2871 L229,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1416.6934" style="stroke: #000000; stroke-width: 2.0;" width="1037" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="181" x="28" y="146.8555">Timeout Handler Consume</text><path d="M33,157.5977 L248,157.5977 L248,164.5977 L238,174.5977 L33,174.5977 L33,157.5977 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="92.2422" style="stroke: #000000; stroke-width: 2.0;" width="702.5" x="33" y="157.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="48" y="171.166">Persist Event Information</text><polygon fill="#A80036" points="661,191.9082,671,195.9082,661,199.9082,665,195.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="139.5" x2="667" y1="195.9082" y2="195.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="146.5" y="191.4766">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="159.5" y="191.4766">Publish event information</text><rect fill="#FFFFFF" filter="url(#f159bje2e7gssk)" height="40.6211" style="stroke: #000000; stroke-width: 2.0;" width="684.5" x="40" y="204.2188"/><polygon fill="#EEEEEE" points="40,204.2188,104,204.2188,104,211.2188,94,221.2188,40,221.2188,40,204.2188" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="53" y="218.7871">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="285.25" y="237.7871">Event Handler Consume {9.1.0.}</text><path d="M33,263.8398 L254,263.8398 L254,270.8398 L244,280.8398 L33,280.8398 L33,263.8398 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="198.4844" style="stroke: #000000; stroke-width: 2.0;" width="1007" x="33" y="263.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="176" x="48" y="277.4082">Request expired transfers</text><polygon fill="#A80036" points="768,313.1504,778,317.1504,768,321.1504,772,317.1504" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="139.5" x2="774" y1="317.1504" y2="317.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="146.5" y="305.374">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="159.5" y="297.7188">Request all expired transfers (Date.now() &gt; expirationDate)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="159.5" y="313.0293">with transferState IN ['RECEIVED', 'RESERVED']</text><polygon fill="#A80036" points="938,342.7715,948,346.7715,938,350.7715,942,346.7715" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="790" x2="944" y1="346.7715" y2="346.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="797" y="342.3398">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="810" y="342.3398">Fetch from database</text><polygon fill="#A80036" points="801,372.082,791,376.082,801,380.082,797,376.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="795" x2="954" y1="376.082" y2="376.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="807" y="371.6504">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="824" y="371.6504"/><polygon fill="#FFFFE0" filter="url(#f159bje2e7gssk)" points="889,389.3926,1020,389.3926,1030,408.3926,1020,427.3926,889,427.3926,879,408.3926,889,389.3926" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="891" y="405.9609">transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="891" y="421.2715">transferStateChange</text><polygon fill="#A80036" points="150.5,450.0137,140.5,454.0137,150.5,458.0137,146.5,454.0137" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="144.5" x2="784" y1="454.0137" y2="454.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="156.5" y="449.582">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="169.5" y="449.582">Return list of all transfers to be aborted</text><path d="M23,476.3242 L97,476.3242 L97,483.3242 L87,493.3242 L23,493.3242 L23,476.3242 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1066.6563" style="stroke: #000000; stroke-width: 2.0;" width="738" x="23" y="476.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="38" y="489.8926">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="160" x="112" y="488.959">[for each transfer in the list]</text><path d="M33,525.6348 L95,525.6348 L95,532.6348 L85,542.6348 L33,542.6348 L33,525.6348 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="951.0352" style="stroke: #000000; stroke-width: 2.0;" width="718" x="33" y="525.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="48" y="539.2031">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="225" x="110" y="538.2695">[transferState == 'RECEIVED_PENDING']</text><path d="M144,547.9453 L144,1016.9453 L737,1016.9453 L737,557.9453 L727,547.9453 L144,547.9453 " fill="#FFFF00" filter="url(#f159bje2e7gssk)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M727,547.9453 L727,557.9453 L737,557.9453 L727,547.9453 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="150" y="565.5137">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="150" y="580.8242">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="166" y="596.1348">id: &lt;transferId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="166" y="611.4453">from: &lt;payerParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="166" y="626.7559">to: &lt;payeeParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="166" y="642.0664">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="166" y="657.377"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="166" y="657.377">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="182" y="672.6875"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="182" y="672.6875">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="182" y="687.998">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="202" y="703.3086">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="218" y="718.6191">"errorCode": 3303,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="504" x="218" y="733.9297">"errorDescription": "Client requested to use a transfer that has already expired.",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="218" y="749.2402">"extensionList": &lt;transferMessage.extensionList&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="202" y="764.5508">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="182" y="779.8613">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="166" y="795.1719"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="166" y="795.1719">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="166" y="810.4824">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="182" y="825.793">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="198" y="841.1035">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="198" y="856.4141">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="198" y="871.7246">action: timeout-received,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="198" y="887.0352">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="198" y="902.3457">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="214" y="917.6563">status: 'error',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="214" y="932.9668">code: &lt;errorInformation.errorCode&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="214" y="948.2773">description: &lt;errorInformation.errorDescription&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="198" y="963.5879">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="182" y="978.8984">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="166" y="994.209">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="150" y="1009.5195">}</text><polygon fill="#A80036" points="520,1043.2617,530,1047.2617,520,1051.2617,524,1047.2617" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="139.5" x2="526" y1="1047.2617" y2="1047.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="146.5" y="1042.8301">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="159.5" y="1042.8301">Publish to Notification event</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="33" x2="751" y1="1086.5723" y2="1086.5723"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="38" y="1097.207">[transferState == 'RESERVED']</text><path d="M144,1105.5273 L144,1467.5273 L378,1467.5273 L378,1115.5273 L368,1105.5273 L144,1105.5273 " fill="#FFFF00" filter="url(#f159bje2e7gssk)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M368,1105.5273 L368,1115.5273 L378,1115.5273 L368,1105.5273 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="150" y="1123.0957">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="150" y="1138.4063">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="166" y="1153.7168">id: &lt;transferId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="166" y="1169.0273">from: &lt;payerParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="166" y="1184.3379">to: &lt;payeeParticipantId&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="166" y="1199.6484">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="166" y="1214.959"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="166" y="1214.959">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="182" y="1230.2695"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="182" y="1230.2695">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="182" y="1245.5801"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="182" y="1245.5801">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="166" y="1260.8906"/><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="166" y="1260.8906">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="166" y="1276.2012">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="182" y="1291.5117">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="198" y="1306.8223">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="198" y="1322.1328">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="198" y="1337.4434">action: timeout-reserved,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="198" y="1352.7539">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="198" y="1368.0645">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="214" y="1383.375">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="214" y="1398.6855">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="198" y="1413.9961">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="182" y="1429.3066">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="166" y="1444.6172">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="150" y="1459.9277">}</text><polygon fill="#A80036" points="351.5,1500.6699,361.5,1504.6699,351.5,1508.6699,355.5,1504.6699" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="139.5" x2="357.5" y1="1504.6699" y2="1504.6699"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="146.5" y="1500.2383">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="159.5" y="1500.2383">Route &amp; Publish Position event</text><!--
@startuml
title 2.3.1. Timeout Handler Consume

autonumber


control "Transfer Timeout Handler" as EXP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
collections "Event-Topic" as TOPIC_EVENT
entity "Transfer DAO" as TRANS_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant EXP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant TOPIC_NOTIFICATIONS
    participant TOPIC_EVENT
    participant TRANS_DAO
    participant DB
end box

activate EXP_HANDLER
group Timeout Handler Consume
    group Persist Event Information
        EXP_HANDLER -> TOPIC_EVENT: Publish event information
        ref over EXP_HANDLER, TOPIC_EVENT :  Event Handler Consume {9.1.0.}
    end

    group Request expired transfers
        EXP_HANDLER -> TRANS_DAO: Request all expired transfers (Date.now() > expirationDate) \nwith transferState IN ['RECEIVED', 'RESERVED']
        activate TRANS_DAO
        TRANS_DAO -> DB: Fetch from database
        activate DB
        DB - -> TRANS_DAO
        deactivate DB
        hnote over DB #lightyellow
            transfer
            transferStateChange
        end note
        EXP_HANDLER <- - TRANS_DAO: Return list of all transfers to be aborted
        deactivate TRANS_DAO
    end

    loop for each transfer in the list
        |||
        alt transferState == 'RECEIVED_PENDING'
            note right of EXP_HANDLER #yellow
                Message:
                {
                    id: <transferId>,
                    from: <payerParticipantId>,
                    to: <payeeParticipantId>,
                    type: application/json,
                    <color #FF0000>content: {</color>
                        <color #FF0000>headers: <transferHeaders>,</color>
                        payload: {
                             "errorInformation": {
                                 "errorCode": 3303,
                                 "errorDescription": "Client requested to use a transfer that has already expired.",
                                 "extensionList": <transferMessage.extensionList>
                             }
                        }
                    <color #FF0000>},</color>
                    metadata: {
                        event: {
                            id: <uuid>,
                            type: position,
                            action: timeout-received,
                            createdAt: <timestamp>,
                            state: {
                                status: 'error',
                                code: <errorInformation.errorCode>
                                description: <errorInformation.errorDescription>
                            }
                        }
                    }
                }
            end note
            EXP_HANDLER -> TOPIC_NOTIFICATIONS: Publish to Notification event
            activate TOPIC_NOTIFICATIONS
            deactivate TOPIC_NOTIFICATIONS
        else transferState == 'RESERVED'
            note right of EXP_HANDLER #yellow
                Message:
                {
                    id: <transferId>,
                    from: <payerParticipantId>,
                    to: <payeeParticipantId>,
                    type: application/json,
                    <color #FF0000>content: {</color>
                        <color #FF0000>headers: <transferHeaders>,</color>
                        <color #FF0000>payload: <transferMessage></color>
                    <color #FF0000>},</color>
                    metadata: {
                        event: {
                            id: <uuid>,
                            type: position,
                            action: timeout-reserved,
                            createdAt: <timestamp>,
                            state: {
                                status: "success",
                                code: 0
                            }
                        }
                    }
                }
            end note
        end
        EXP_HANDLER -> TOPIC_POSITION_DFSP1: Route & Publish Position event
        activate TOPIC_POSITION_DFSP1
        deactivate TOPIC_POSITION_DFSP1
    end
end
@enduml

PlantUML version 1.2018.01(Sun Jan 28 20:08:22 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1136-b20
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>